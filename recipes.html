<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipes Hub - Bean's Hub</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        /* Modern Kitchen Theme - Clean whites with silver accents */
        --primary: #6b7280;
        --primary-light: #9ca3af;
        --primary-dark: #374151;
        --accent: #c0c7d0;
        --silver: #e5e7eb;
        --silver-light: #f3f4f6;
        --silver-dark: #d1d5db;
        --background: linear-gradient(
          135deg,
          #f8fafc 0%,
          #f1f5f9 50%,
          #e2e8f0 100%
        );
        --surface: rgba(255, 255, 255, 0.9);
        --surface-hover: rgba(255, 255, 255, 1);
        --text: #1f2937;
        --text-secondary: #4b5563;
        --text-muted: #6b7280;
        --border: rgba(203, 213, 225, 0.6);
        --shadow: rgba(15, 23, 42, 0.08);
        --shadow-strong: rgba(15, 23, 42, 0.15);
        --warm-white: #fefefe;
        --kitchen-steel: #8b9dc3;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--background);
        min-height: 100vh;
        color: var(--text);
        overflow-x: hidden;
      }

      /* Header */
      .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 2px solid var(--silver);
        padding: 1rem 1rem 0.8rem;
        box-shadow: 0 2px 20px var(--shadow);
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 100%;
      }

      .back-btn {
        background: var(--surface);
        border: 2px solid var(--silver-dark);
        border-radius: 12px;
        padding: 0.6rem 1.2rem;
        color: var(--text);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.6rem;
        box-shadow: 0 2px 8px var(--shadow);
      }

      .back-btn:hover {
        background: var(--surface-hover);
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-strong);
      }

      .page-title {
        font-family: "Playfair Display", serif;
        font-size: 1.6rem;
        font-weight: 600;
        color: var(--text);
        text-align: center;
        flex: 1;
        margin: 0 1rem;
        position: relative;
      }

      .page-title::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 2px;
        background: linear-gradient(
          90deg,
          var(--silver-dark),
          var(--primary),
          var(--silver-dark)
        );
        border-radius: 1px;
      }

      .liked-count {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        border-radius: 20px;
        padding: 0.6rem 1rem;
        font-weight: 600;
        font-size: 0.8rem;
        box-shadow: 0 4px 12px var(--shadow-strong);
        border: 1px solid var(--silver);
      }

      /* Main content */
      .main {
        padding-top: 5.5rem;
        padding-bottom: 2rem;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 2rem;
      }

      /* Sidebar */
      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      /* Categories Section */
      .categories-section {
        background: var(--surface);
        border: 2px solid var(--silver);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 25px var(--shadow);
        backdrop-filter: blur(10px);
      }

      .section-header {
        padding: 1.2rem 1.5rem;
        background: linear-gradient(
          135deg,
          var(--silver-light),
          var(--warm-white)
        );
        border-bottom: 2px solid var(--silver);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .section-header:hover {
        background: linear-gradient(135deg, var(--silver), var(--silver-light));
      }

      .section-title {
        font-family: "Playfair Display", serif;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.6rem;
      }

      .collapse-icon {
        font-size: 0.9rem;
        color: var(--text-secondary);
        transition: transform 0.3s ease;
        background: var(--silver-light);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .collapse-icon.collapsed {
        transform: rotate(-90deg);
      }

      .section-content {
        padding: 1.2rem 1.5rem;
        max-height: 400px;
        overflow-y: auto;
        transition: max-height 0.3s ease, padding 0.3s ease;
        scrollbar-width: thin;
        scrollbar-color: var(--silver-dark) transparent;
        background: var(--warm-white);
      }

      .section-content::-webkit-scrollbar {
        width: 8px;
      }

      .section-content::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, var(--silver-dark), var(--primary));
        border-radius: 4px;
      }

      .section-content::-webkit-scrollbar-track {
        background: var(--silver-light);
        border-radius: 4px;
      }

      .section-content.collapsed {
        max-height: 0;
        padding: 0 1.5rem;
      }

      .category-grid {
        display: grid;
        gap: 0.5rem;
      }

      .category-group {
        display: grid;
        gap: 0.4rem;
        margin-bottom: 1rem;
        padding: 0.8rem;
        background: linear-gradient(
          135deg,
          var(--silver-light),
          var(--warm-white)
        );
        border-radius: 12px;
        border: 1px solid var(--silver);
      }

      .category-group:last-child {
        margin-bottom: 0;
      }

      .category-btn {
        background: var(--warm-white);
        border: 1px solid var(--silver);
        border-radius: 10px;
        padding: 0.7rem 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        box-shadow: 0 2px 4px var(--shadow);
      }

      .category-btn:hover {
        background: var(--silver-light);
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--shadow-strong);
      }

      .category-btn.active {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        color: white;
        border-color: var(--primary-dark);
        box-shadow: 0 4px 12px var(--shadow-strong);
      }

      .category-name {
        font-weight: 600;
        margin-bottom: 0.2rem;
        font-size: 0.85rem;
        letter-spacing: 0.02em;
      }

      .category-desc {
        font-size: 0.75rem;
        opacity: 0.8;
        line-height: 1.2;
      }

      /* Saved Recipes Section */
      .saved-section {
        background: var(--surface);
        border: 2px solid var(--silver);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 25px var(--shadow);
        backdrop-filter: blur(10px);
      }

      .saved-content {
        padding: 1.2rem 1.5rem;
        max-height: 400px;
        overflow-y: auto;
        background: var(--warm-white);
      }

      .saved-grid {
        display: grid;
        gap: 0.8rem;
      }

      .saved-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: var(--warm-white);
        border: 1px solid var(--silver);
        border-radius: 12px;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px var(--shadow);
      }

      .saved-item:hover {
        background: var(--silver-light);
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px var(--shadow-strong);
      }

      .saved-thumb {
        width: 55px;
        height: 55px;
        border-radius: 10px;
        object-fit: cover;
        flex-shrink: 0;
        border: 2px solid var(--silver);
        box-shadow: 0 2px 6px var(--shadow);
      }

      .saved-info {
        flex: 1;
        min-width: 0;
      }

      .saved-name {
        font-weight: 600;
        margin-bottom: 0.3rem;
        font-size: 0.9rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: var(--text);
      }

      .saved-cuisine {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      /* Swipe Section */
      .swipe-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }

      .swipe-container {
        position: relative;
        width: 100%;
        max-width: 450px;
        height: 600px;
        margin-bottom: 2rem;
      }

      .recipe-card {
        position: absolute;
        width: 100%;
        height: 100%;
        background: var(--warm-white);
        border-radius: 24px;
        box-shadow: 0 20px 60px var(--shadow-strong);
        overflow: hidden;
        cursor: grab;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        user-select: none;
        display: flex;
        flex-direction: column;
        border: 3px solid var(--silver);
      }

      .recipe-card:active {
        cursor: grabbing;
      }

      .recipe-card:hover {
        box-shadow: 0 25px 70px var(--shadow-strong);
        transform: translateY(-5px);
      }

      .recipe-card.dragging {
        transition: none;
      }

      .recipe-image {
        width: 100%;
        height: 80%;
        object-fit: cover;
        background: linear-gradient(
          135deg,
          var(--silver),
          var(--primary-light)
        );
      }

      .recipe-content {
        padding: 1.2rem 1.8rem;
        height: 20%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text);
        background: linear-gradient(
          135deg,
          var(--warm-white),
          var(--silver-light)
        );
        border-top: 2px solid var(--silver);
      }

      .recipe-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
        line-height: 1.3;
        text-align: center;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Swipe Indicators */
      .swipe-indicators {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 4rem;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.2s ease;
        pointer-events: none;
        z-index: 10;
      }

      .swipe-like {
        right: 2rem;
        color: #059669;
        text-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
      }

      .swipe-pass {
        left: 2rem;
        color: #dc2626;
        text-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
      }

      .swipe-indicators.show {
        opacity: 0.9;
      }

      /* Action Buttons */
      .action-buttons {
        display: flex;
        gap: 2.5rem;
        align-items: center;
      }

      .action-btn {
        width: 75px;
        height: 75px;
        border-radius: 50%;
        border: 3px solid;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px var(--shadow);
        font-weight: 600;
      }

      .action-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 12px 35px var(--shadow-strong);
      }

      .pass-btn {
        background: linear-gradient(135deg, #fef2f2, #ffffff);
        color: #dc2626;
        border-color: #fca5a5;
      }

      .pass-btn:hover {
        background: linear-gradient(135deg, #fee2e2, #fef2f2);
        border-color: #f87171;
      }

      .like-btn {
        background: linear-gradient(135deg, #f0fdf4, #ffffff);
        color: #059669;
        border-color: #86efac;
      }

      .like-btn:hover {
        background: linear-gradient(135deg, #dcfce7, #f0fdf4);
        border-color: #4ade80;
      }

      /* Loading State */
      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        font-size: 1.1rem;
        color: var(--text-secondary);
        background: var(--warm-white);
        border-radius: 24px;
        border: 3px solid var(--silver);
      }

      .spinner {
        width: 28px;
        height: 28px;
        border: 3px solid var(--silver);
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Recipe Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.75);
        z-index: 1000;
        backdrop-filter: blur(8px);
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .modal-content {
        background: var(--warm-white);
        border-radius: 24px;
        max-width: 700px;
        width: 100%;
        max-height: 90vh;
        overflow: hidden;
        position: relative;
        color: var(--text);
        border: 3px solid var(--silver);
        box-shadow: 0 25px 80px var(--shadow-strong);
      }

      .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: var(--warm-white);
        border: 2px solid var(--silver);
        border-radius: 50%;
        width: 42px;
        height: 42px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: var(--text-secondary);
        z-index: 10;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px var(--shadow);
      }

      .modal-close:hover {
        background: var(--silver-light);
        color: var(--text);
        transform: scale(1.1);
        box-shadow: 0 6px 16px var(--shadow-strong);
      }

      .modal-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-bottom: 3px solid var(--silver);
      }

      .modal-body {
        padding: 2rem;
        max-height: calc(90vh - 250px);
        overflow-y: auto;
        background: var(--warm-white);
      }

      .modal-title {
        font-family: "Playfair Display", serif;
        font-size: 1.9rem;
        font-weight: 600;
        margin-bottom: 0.6rem;
        color: var(--text);
        line-height: 1.3;
      }

      .modal-cuisine {
        color: var(--primary);
        font-weight: 600;
        margin-bottom: 1.8rem;
        font-size: 1rem;
        padding: 0.5rem 1rem;
        background: var(--silver-light);
        border-radius: 20px;
        display: inline-block;
        border: 1px solid var(--silver);
      }

      .ingredients-section,
      .instructions-section {
        margin-bottom: 2rem;
      }

      .section-header-modal {
        font-family: "Playfair Display", serif;
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 1.2rem;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.6rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--silver);
      }

      .ingredients-list {
        list-style: none;
        display: grid;
        gap: 0.6rem;
      }

      .ingredient-item {
        background: linear-gradient(
          135deg,
          var(--silver-light),
          var(--warm-white)
        );
        padding: 0.9rem;
        border-radius: 10px;
        font-size: 0.9rem;
        border-left: 4px solid var(--primary);
        border: 1px solid var(--silver);
        box-shadow: 0 2px 4px var(--shadow);
      }

      .instructions {
        line-height: 1.8;
        font-size: 0.95rem;
        color: var(--text);
        white-space: pre-line;
        background: var(--silver-light);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid var(--silver);
      }

      /* Empty States */
      .empty-state {
        text-align: center;
        padding: 2.5rem 1rem;
        color: var(--text-muted);
        background: var(--warm-white);
        border-radius: 16px;
        border: 2px dashed var(--silver);
      }

      .empty-icon {
        font-size: 3rem;
        margin-bottom: 1.2rem;
        opacity: 0.7;
      }

      .empty-state p {
        font-size: 0.9rem;
        line-height: 1.5;
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .container {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
      }

      @media (max-width: 768px) {
        .container {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }

        /* Mobile layout order */
        .categories-section {
          order: 1;
        }

        .swipe-section {
          order: 2;
        }

        .saved-section {
          order: 3;
        }

        .swipe-container {
          max-width: 380px;
          height: 520px;
        }

        .action-btn {
          width: 65px;
          height: 65px;
          font-size: 1.5rem;
        }

        .modal-content {
          margin: 1rem;
          max-height: 85vh;
        }

        .modal-body {
          padding: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .header {
          padding: 0.8rem 1rem 0.6rem;
        }

        .page-title {
          font-size: 1.3rem;
        }

        .main {
          padding-top: 4.8rem;
        }

        .container {
          padding: 0 0.5rem;
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }

        /* Mobile layout order */
        .categories-section {
          order: 1;
        }

        .swipe-section {
          order: 2;
        }

        .saved-section {
          order: 3;
        }

        .swipe-container {
          max-width: 340px;
          height: 480px;
        }

        .recipe-content {
          padding: 1rem;
        }

        .action-buttons {
          gap: 2rem;
        }

        .action-btn {
          width: 60px;
          height: 60px;
          font-size: 1.3rem;
        }
      }

      /* Additional modern touches */
      .category-group::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          var(--silver),
          transparent
        );
      }

      .saved-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 3px;
        height: 60%;
        background: linear-gradient(
          180deg,
          var(--primary-light),
          var(--primary)
        );
        border-radius: 0 2px 2px 0;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .saved-item:hover::before {
        opacity: 1;
      }

      /* Kitchen-inspired decorative elements */
      .section-title::before {
        content: "◊";
        color: var(--silver-dark);
        font-size: 0.8rem;
        margin-right: 0.3rem;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-content">
        <a href="index.html" class="back-btn">
          <span>←</span>
          <span>Hub</span>
        </a>
        <h1 class="page-title">Recipes Hub</h1>
        <div class="liked-count" id="likedCount">♥ 0 Saved</div>
      </div>
    </div>

    <main class="main">
      <div class="container">
        <!-- Categories -->
        <div class="categories-section">
          <div class="section-header" onclick="toggleSection('categories')">
            <div class="section-title">Categories</div>
            <div class="collapse-icon">▼</div>
          </div>
          <div class="section-content" id="categoriesContent">
            <div class="category-grid" id="categoriesGrid">
              <!-- Categories will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Swipe Section -->
        <div class="swipe-section">
          <div class="swipe-container" id="swipeContainer">
            <!-- Recipe cards will be loaded here -->
          </div>

          <div class="action-buttons">
            <button class="action-btn pass-btn" onclick="swipeCard('left')">
              ✕
            </button>
            <button class="action-btn like-btn" onclick="swipeCard('right')">
              ♥
            </button>
          </div>
        </div>

        <!-- Saved Recipes -->
        <div class="saved-section">
          <div class="section-header" onclick="toggleSection('saved')">
            <div class="section-title">Saved Recipes</div>
            <div class="collapse-icon">▼</div>
          </div>
          <div class="section-content saved-content" id="savedContent">
            <div class="saved-grid" id="savedGrid">
              <div class="empty-state">
                <div class="empty-icon">🍽️</div>
                <p>
                  No saved recipes yet.<br />Start swiping to save your
                  favorites!
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Recipe Modal -->
    <div class="modal" id="recipeModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeModal()">✕</button>
        <div id="modalContent">
          <!-- Recipe details will be loaded here -->
        </div>
      </div>
    </div>

    <script>
      // App State
      let currentCategory = "Beef";
      let recipeQueue = [];
      let likedRecipes = JSON.parse(
        localStorage.getItem("likedRecipes") || "[]"
      );
      let currentRecipeIndex = 0;
      let isDragging = false;
      let allAvailableRecipes = []; // Store all recipes for current category
      let usedRecipeIds = new Set(); // Track which recipes we've already shown

      // Section collapse states
      let sectionStates = {
        categories: true, // expanded by default
        saved: true, // expanded by default
      };

      // Categories from TheMealDB + custom searches
      const categories = [
        // Original TheMealDB categories
        { name: "Beef", desc: "Hearty meat dishes", type: "category" },
        { name: "Chicken", desc: "Versatile poultry", type: "category" },
        { name: "Pork", desc: "Savory dishes", type: "category" },
        { name: "Seafood", desc: "Ocean delights", type: "category" },
        { name: "Lamb", desc: "Rich flavors", type: "category" },
        { name: "Pasta", desc: "Italian classics", type: "category" },
        { name: "Dessert", desc: "Sweet treats", type: "category" },
        { name: "Breakfast", desc: "Morning meals", type: "category" },
        { name: "Vegetarian", desc: "Plant-based meals", type: "category" },

        // Area-based categories (cuisines)
        { name: "Italian", desc: "Mediterranean flavors", type: "area" },
        { name: "Chinese", desc: "Asian classics", type: "area" },
        { name: "Mexican", desc: "Vibrant & zesty", type: "area" },
        { name: "Japanese", desc: "Clean & elegant", type: "area" },

        // Search-based categories (for specific needs)
        {
          name: "Light Lunch",
          desc: "Quick & healthy",
          type: "search",
          query: "salad",
        },
        {
          name: "Comfort Food",
          desc: "Cozy & satisfying",
          type: "search",
          query: "fried",
        },
        {
          name: "Quick Meals",
          desc: "15 min or less",
          type: "search",
          query: "quick",
        },
        {
          name: "Healthy",
          desc: "Nutritious options",
          type: "search",
          query: "healthy",
        },
      ];

      // Toggle section collapse
      function toggleSection(sectionName) {
        sectionStates[sectionName] = !sectionStates[sectionName];

        const content = document.getElementById(sectionName + "Content");
        const icon = document.querySelector(
          `[onclick="toggleSection('${sectionName}')"] .collapse-icon`
        );

        if (sectionStates[sectionName]) {
          content.classList.remove("collapsed");
          icon.classList.remove("collapsed");
        } else {
          content.classList.add("collapsed");
          icon.classList.add("collapsed");
        }
      }

      // Initialize app
      async function init() {
        renderCategories();
        renderLikedRecipes();

        // Load initial category
        const initialCategory =
          categories.find((c) => c.name === currentCategory) || categories[0];
        await loadRecipes(initialCategory);
        updateLikedCount();
      }

      // Render categories
      function renderCategories() {
        const grid = document.getElementById("categoriesGrid");

        // Group categories by type
        const proteinCategories = categories.filter((cat) =>
          ["Beef", "Chicken", "Pork", "Seafood", "Lamb"].includes(cat.name)
        );

        const cuisineCategories = categories.filter((cat) =>
          ["Italian", "Chinese", "Mexican", "Japanese"].includes(cat.name)
        );

        const classicCategories = categories.filter((cat) =>
          ["Pasta", "Dessert", "Breakfast", "Vegetarian"].includes(cat.name)
        );

        const lifestyleCategories = categories.filter((cat) =>
          ["Light Lunch", "Comfort Food", "Quick Meals", "Healthy"].includes(
            cat.name
          )
        );

        // Render grouped categories
        grid.innerHTML = `
          <div class="category-group">
            ${proteinCategories
              .map(
                (cat) => `
              <div class="category-btn ${
                cat.name === currentCategory ? "active" : ""
              }" 
                   onclick="selectCategory('${cat.name}')">
                  <div class="category-name">${cat.name}</div>
                  <div class="category-desc">${cat.desc}</div>
              </div>
            `
              )
              .join("")}
          </div>
          
          <div class="category-group">
            ${cuisineCategories
              .map(
                (cat) => `
              <div class="category-btn ${
                cat.name === currentCategory ? "active" : ""
              }" 
                   onclick="selectCategory('${cat.name}')">
                  <div class="category-name">${cat.name}</div>
                  <div class="category-desc">${cat.desc}</div>
              </div>
            `
              )
              .join("")}
          </div>
          
          <div class="category-group">
            ${classicCategories
              .map(
                (cat) => `
              <div class="category-btn ${
                cat.name === currentCategory ? "active" : ""
              }" 
                   onclick="selectCategory('${cat.name}')">
                  <div class="category-name">${cat.name}</div>
                  <div class="category-desc">${cat.desc}</div>
              </div>
            `
              )
              .join("")}
          </div>
          
          <div class="category-group">
            ${lifestyleCategories
              .map(
                (cat) => `
              <div class="category-btn ${
                cat.name === currentCategory ? "active" : ""
              }" 
                   onclick="selectCategory('${cat.name}')">
                  <div class="category-name">${cat.name}</div>
                  <div class="category-desc">${cat.desc}</div>
              </div>
            `
              )
              .join("")}
          </div>
        `;
      }

      // Select category
      async function selectCategory(categoryName) {
        if (categoryName === currentCategory) return;

        currentCategory = categoryName;
        renderCategories();

        const categoryObj = categories.find((c) => c.name === categoryName);
        await loadRecipes(categoryObj);
      }

      // Load recipes from TheMealDB with multiple API endpoints
      async function loadRecipes(categoryObj, isLoadingMore = false) {
        const container = document.getElementById("swipeContainer");

        if (!isLoadingMore) {
          container.innerHTML =
            '<div class="loading"><div class="spinner"></div>Loading recipes...</div>';
          // Reset state for new category
          allAvailableRecipes = [];
          usedRecipeIds.clear();
        }

        try {
          let url;
          const category =
            typeof categoryObj === "string"
              ? categories.find((c) => c.name === categoryObj)
              : categoryObj;

          if (!category) {
            throw new Error("Category not found");
          }

          let allMeals = [];

          // If we're loading more and have unused recipes, use those first
          if (isLoadingMore && allAvailableRecipes.length > 0) {
            const unusedRecipes = allAvailableRecipes.filter(
              (recipe) => !usedRecipeIds.has(recipe.idMeal)
            );

            if (unusedRecipes.length > 0) {
              console.log(
                `Using ${unusedRecipes.length} cached unused recipes`
              );
              allMeals = unusedRecipes;
            }
          }

          // If we don't have enough unused recipes, fetch fresh ones
          if (allMeals.length < 10) {
            console.log(`Fetching fresh recipes for ${category.name}...`);

            // Special handling for search-based categories to get more results
            if (category.type === "search") {
              // For Comfort Food, try multiple search terms
              if (category.name === "Comfort Food") {
                const comfortQueries = ["chicken", "beef", "cheese", "bacon"];
                for (const query of comfortQueries) {
                  try {
                    const response = await fetch(
                      `https://www.themealdb.com/api/json/v1/1/search.php?s=${query}`
                    );
                    const data = await response.json();
                    if (data.meals) {
                      allMeals.push(...data.meals);
                    }
                  } catch (error) {
                    console.warn(`Failed to fetch ${query} recipes:`, error);
                  }
                }
              } else {
                // For other search categories, use the original query
                const response = await fetch(
                  `https://www.themealdb.com/api/json/v1/1/search.php?s=${category.query}`
                );
                const data = await response.json();
                if (data.meals) {
                  allMeals = data.meals;
                }
              }
            } else {
              // Build API URL based on category type
              switch (category.type) {
                case "category":
                  url = `https://www.themealdb.com/api/json/v1/1/filter.php?c=${category.name}`;
                  break;
                case "area":
                  url = `https://www.themealdb.com/api/json/v1/1/filter.php?a=${category.name}`;
                  break;
              }

              console.log(`Loading ${category.name} recipes from: ${url}`);

              const response = await fetch(url);
              const data = await response.json();
              if (data.meals) {
                allMeals = data.meals;
              }
            }

            // Store all available recipes for this category (if not loading more)
            if (!isLoadingMore) {
              // Remove duplicates based on meal ID
              allAvailableRecipes = allMeals.filter(
                (meal, index, self) =>
                  index === self.findIndex((m) => m.idMeal === meal.idMeal)
              );
              console.log(
                `Stored ${allAvailableRecipes.length} total recipes for ${category.name}`
              );
            }
          }

          if (allMeals && allMeals.length > 0) {
            // Remove duplicates and filter out already used recipes
            let availableRecipes = allMeals.filter(
              (meal, index, self) =>
                index === self.findIndex((m) => m.idMeal === meal.idMeal) &&
                !usedRecipeIds.has(meal.idMeal)
            );

            // Special filtering for Vegetarian category to remove meat dishes
            if (category.name === "Vegetarian") {
              availableRecipes = availableRecipes.filter((meal) => {
                const title = meal.strMeal.toLowerCase();
                const meatKeywords = [
                  "chicken",
                  "beef",
                  "pork",
                  "lamb",
                  "turkey",
                  "duck",
                  "bacon",
                  "ham",
                  "sausage",
                  "meat",
                  "fish",
                  "salmon",
                  "tuna",
                  "shrimp",
                  "crab",
                  "lobster",
                  "prawn",
                  "anchovy",
                  "sardine",
                  "cod",
                  "sea bass",
                  "scallop",
                  "mussel",
                  "oyster",
                  "clam",
                  "seafood",
                ];

                // Check if meal title contains any meat keywords
                const containsMeat = meatKeywords.some((keyword) =>
                  title.includes(keyword)
                );

                if (containsMeat) {
                  console.log(`Filtered out non-vegetarian: ${meal.strMeal}`);
                  return false;
                }
                return true;
              });

              console.log(
                `Filtered vegetarian recipes: ${availableRecipes.length} remaining`
              );
            }

            if (availableRecipes.length > 0) {
              // Shuffle the available recipes
              const shuffledMeals = [...availableRecipes].sort(
                () => Math.random() - 0.5
              );

              // Take a batch of 15-20 recipes
              const batchSize = Math.min(
                15 + Math.floor(Math.random() * 6),
                shuffledMeals.length
              );
              const newRecipes = shuffledMeals.slice(0, batchSize);

              // Mark these recipes as used
              newRecipes.forEach((recipe) => usedRecipeIds.add(recipe.idMeal));

              if (isLoadingMore) {
                // Add to existing queue
                recipeQueue.push(...newRecipes);
                console.log(
                  `Added ${newRecipes.length} more recipes. Total queue: ${recipeQueue.length}`
                );
              } else {
                // Replace queue with new recipes
                recipeQueue = newRecipes;
                currentRecipeIndex = 0;
                console.log(
                  `Loaded ${recipeQueue.length} random ${category.name} recipes`
                );
              }

              if (!isLoadingMore) {
                renderCurrentCard();
              }
            } else {
              // No more unused recipes available
              if (isLoadingMore) {
                console.log(
                  "No more unique recipes available for this category"
                );
                return false; // Indicate no more recipes loaded
              } else {
                await loadRandomFallback();
              }
            }
          } else {
            // If no results, try a fallback random search
            if (!isLoadingMore) {
              console.log(
                `No recipes found for ${category.name}, trying random recipes...`
              );
              await loadRandomFallback();
            }
          }

          return true; // Indicate recipes were loaded
        } catch (error) {
          console.error("Error loading recipes:", error);
          if (!isLoadingMore) {
            // Try random fallback on error
            await loadRandomFallback();
          }
          return false;
        }
      }

      // Fallback function to load random recipes when category fails
      async function loadRandomFallback() {
        try {
          const container = document.getElementById("swipeContainer");
          container.innerHTML =
            '<div class="loading"><div class="spinner"></div>Finding random recipes...</div>';

          // Get multiple random recipes
          const randomPromises = Array.from({ length: 15 }, () =>
            fetch("https://www.themealdb.com/api/json/v1/1/random.php").then(
              (r) => r.json()
            )
          );

          const results = await Promise.allSettled(randomPromises);
          const randomMeals = results
            .filter(
              (result) => result.status === "fulfilled" && result.value.meals
            )
            .map((result) => result.value.meals[0])
            .filter(Boolean);

          if (randomMeals.length > 0) {
            recipeQueue = randomMeals;
            currentRecipeIndex = 0;
            renderCurrentCard();
            console.log(`Loaded ${randomMeals.length} random fallback recipes`);
          } else {
            throw new Error("No random recipes available");
          }
        } catch (error) {
          console.error("Error loading random fallback:", error);
          const container = document.getElementById("swipeContainer");
          container.innerHTML =
            '<div class="empty-state"><div class="empty-icon">⌐</div><p>Failed to load recipes. Please try again.</p></div>';
        }
      }

      // Render current recipe card
      function renderCurrentCard() {
        const container = document.getElementById("swipeContainer");

        // Check if we're running low on recipes and need to load more
        if (currentRecipeIndex >= recipeQueue.length - 3) {
          console.log("Running low on recipes, loading more...");
          loadMoreRecipes();
        }

        if (currentRecipeIndex >= recipeQueue.length) {
          container.innerHTML =
            '<div class="empty-state"><div class="empty-icon">🎉</div><p>Loading more recipes...<br>Please wait!</p></div>';
          return;
        }

        const recipe = recipeQueue[currentRecipeIndex];

        container.innerHTML = `
                <div class="recipe-card" id="currentCard">
                    <div class="swipe-indicators swipe-pass" id="passIndicator">✕</div>
                    <div class="swipe-indicators swipe-like" id="likeIndicator">♥</div>
                    <img src="${recipe.strMealThumb}" alt="${recipe.strMeal}" class="recipe-image">
                    <div class="recipe-content">
                        <h3 class="recipe-title">${recipe.strMeal}</h3>
                    </div>
                </div>
            `;

        setupCardInteractions();
      }

      // Load more recipes for current category
      async function loadMoreRecipes() {
        const categoryObj = categories.find((c) => c.name === currentCategory);
        if (categoryObj) {
          const success = await loadRecipes(categoryObj, true);
          if (!success) {
            console.log("No more recipes available, switching to random mode");
            // If no more recipes in category, load random ones
            await loadRandomFallback();
          }
        }
      }

      // Extract key ingredients for tags
      function extractIngredients(recipe) {
        const ingredients = [];
        for (let i = 1; i <= 20; i++) {
          const ingredient = recipe[`strIngredient${i}`];
          if (ingredient && ingredient.trim()) {
            ingredients.push(ingredient.trim());
          }
        }
        return ingredients;
      }

      // Setup card drag interactions
      function setupCardInteractions() {
        const card = document.getElementById("currentCard");
        if (!card) return;

        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        // Mouse events
        card.addEventListener("mousedown", startDrag);
        document.addEventListener("mousemove", drag);
        document.addEventListener("mouseup", endDrag);

        // Touch events
        card.addEventListener("touchstart", startDrag, { passive: false });
        document.addEventListener("touchmove", drag, { passive: false });
        document.addEventListener("touchend", endDrag);

        function startDrag(e) {
          isDragging = true;
          startX = e.type === "mousedown" ? e.clientX : e.touches[0].clientX;
          card.classList.add("dragging");
        }

        function drag(e) {
          if (!isDragging) return;
          e.preventDefault();

          currentX =
            (e.type === "mousemove" ? e.clientX : e.touches[0].clientX) -
            startX;
          const rotation = currentX * 0.1;

          card.style.transform = `translateX(${currentX}px) rotate(${rotation}deg)`;

          // Show indicators
          const passIndicator = document.getElementById("passIndicator");
          const likeIndicator = document.getElementById("likeIndicator");

          if (currentX < -50) {
            passIndicator.classList.add("show");
            likeIndicator.classList.remove("show");
          } else if (currentX > 50) {
            likeIndicator.classList.add("show");
            passIndicator.classList.remove("show");
          } else {
            passIndicator.classList.remove("show");
            likeIndicator.classList.remove("show");
          }
        }

        function endDrag() {
          if (!isDragging) return;
          isDragging = false;

          card.classList.remove("dragging");

          // Determine swipe direction
          if (Math.abs(currentX) > 100) {
            if (currentX > 0) {
              swipeCard("right");
            } else {
              swipeCard("left");
            }
          } else {
            // Snap back
            card.style.transform = "";
            document.getElementById("passIndicator").classList.remove("show");
            document.getElementById("likeIndicator").classList.remove("show");
          }

          currentX = 0;
        }
      }

      // Swipe card programmatically
      function swipeCard(direction) {
        const card = document.getElementById("currentCard");
        if (!card) return;

        const recipe = recipeQueue[currentRecipeIndex];

        if (direction === "right") {
          // Like recipe
          if (!likedRecipes.find((r) => r.idMeal === recipe.idMeal)) {
            likedRecipes.push(recipe);
            localStorage.setItem("likedRecipes", JSON.stringify(likedRecipes));
            renderLikedRecipes();
            updateLikedCount();
          }
          card.style.transform = "translateX(500px) rotate(30deg)";
        } else {
          // Pass recipe
          card.style.transform = "translateX(-500px) rotate(-30deg)";
        }

        card.style.opacity = "0";

        setTimeout(() => {
          currentRecipeIndex++;
          renderCurrentCard();
        }, 300);
      }

      // Render liked recipes
      function renderLikedRecipes() {
        const grid = document.getElementById("savedGrid");

        if (likedRecipes.length === 0) {
          grid.innerHTML =
            '<div class="empty-state"><div class="empty-icon">🍽️</div><p>No saved recipes yet.<br>Start swiping to save your favorites!</p></div>';
          return;
        }

        grid.innerHTML = likedRecipes
          .map(
            (recipe) => `
                <div class="saved-item" onclick="showRecipeModal('${recipe.idMeal}')">
                    <img src="${recipe.strMealThumb}" alt="${recipe.strMeal}" class="saved-thumb">
                    <div class="saved-info">
                        <div class="saved-name">${recipe.strMeal}</div>
                        <div class="saved-cuisine">${currentCategory}</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Update liked count
      function updateLikedCount() {
        document.getElementById(
          "likedCount"
        ).textContent = `♥ ${likedRecipes.length} Saved`;
      }

      // Show recipe modal with full details
      async function showRecipeModal(mealId) {
        const modal = document.getElementById("recipeModal");
        const content = document.getElementById("modalContent");

        content.innerHTML =
          '<div class="loading"><div class="spinner"></div>Loading recipe details...</div>';
        modal.classList.add("active");

        try {
          const response = await fetch(
            `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${mealId}`
          );
          const data = await response.json();
          const recipe = data.meals[0];

          // Extract ingredients with measurements
          const ingredients = [];
          for (let i = 1; i <= 20; i++) {
            const ingredient = recipe[`strIngredient${i}`];
            const measure = recipe[`strMeasure${i}`];
            if (ingredient && ingredient.trim()) {
              ingredients.push(
                `${measure ? measure.trim() + " " : ""}${ingredient.trim()}`
              );
            }
          }

          // Format instructions for better readability
          let instructions =
            recipe.strInstructions || "Instructions not available.";

          // Clean up the instructions to prevent breaking
          instructions = instructions
            .replace(/\r\n/g, "\n")
            .replace(/\r/g, "\n")
            .split("\n")
            .filter((line) => line.trim())
            .map((line, index) => {
              const trimmed = line.trim();
              // Don't auto-number if already numbered
              if (trimmed.match(/^(\d+\.|STEP \d+)/i)) {
                return trimmed;
              }
              // Only add numbers to substantial lines
              if (trimmed.length > 20) {
                return `${index + 1}. ${trimmed}`;
              }
              return trimmed;
            })
            .join("\n\n");

          content.innerHTML = `
                    <img src="${recipe.strMealThumb}" alt="${
            recipe.strMeal
          }" class="modal-image">
                    <div class="modal-body">
                        <h2 class="modal-title">${recipe.strMeal}</h2>
                        <div class="modal-cuisine">
                            🌍 ${recipe.strArea || "International"} • 
                            🍽️ ${recipe.strCategory}
                            ${recipe.strTags ? ` • 🏷️ ${recipe.strTags}` : ""}
                        </div>
                        
                        <div class="ingredients-section">
                            <h3 class="section-header-modal">
                                🛒 Ingredients (${ingredients.length} items)
                            </h3>
                            <ul class="ingredients-list">
                                ${ingredients
                                  .map(
                                    (ing) =>
                                      `<li class="ingredient-item">${ing}</li>`
                                  )
                                  .join("")}
                            </ul>
                        </div>
                        
                        <div class="instructions-section">
                            <h3 class="section-header-modal">
                                👨‍🍳 Instructions
                            </h3>
                            <div class="instructions">${instructions}</div>
                        </div>

                        ${
                          recipe.strYoutube
                            ? `
                            <div style="margin-top: 2rem; text-align: center;">
                                <a href="${recipe.strYoutube}" target="_blank" 
                                   style="display: inline-flex; align-items: center; gap: 0.5rem; 
                                          background: #ff0000; color: white; padding: 0.8rem 1.5rem; 
                                          border-radius: 12px; text-decoration: none; font-weight: 600;
                                          transition: all 0.3s ease;">
                                    📺 Watch Video Tutorial
                                </a>
                            </div>
                        `
                            : ""
                        }

                        ${
                          recipe.strSource
                            ? `
                            <div style="margin-top: 1rem; text-align: center;">
                                <a href="${recipe.strSource}" target="_blank" 
                                   style="display: inline-flex; align-items: center; gap: 0.5rem; 
                                          background: var(--primary); color: white; padding: 0.6rem 1.2rem; 
                                          border-radius: 8px; text-decoration: none; font-weight: 500;
                                          font-size: 0.9rem; transition: all 0.3s ease;">
                                    🔗 Original Recipe Source
                                </a>
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
        } catch (error) {
          content.innerHTML =
            '<div class="empty-state"><div class="empty-icon">⌐</div><p>Failed to load recipe details.</p></div>';
        }
      }

      // Close modal
      function closeModal() {
        document.getElementById("recipeModal").classList.remove("active");
      }

      // Close modal when clicking outside
      document
        .getElementById("recipeModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeModal();
          }
        });

      // Initialize app when page loads
      document.addEventListener("DOMContentLoaded", init);

      // Add touch feedback for mobile
      document.addEventListener("DOMContentLoaded", function () {
        const interactiveElements = document.querySelectorAll(
          ".back-btn, .category-btn, .saved-item, .action-btn, .section-header"
        );

        interactiveElements.forEach((element) => {
          element.addEventListener("touchstart", function () {
            this.style.transform = "scale(0.95)";
          });

          element.addEventListener("touchend", function () {
            this.style.transform = "scale(1)";
          });
        });
      });
    </script>
  </body>
</html>
